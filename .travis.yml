sudo: false
language: python
cache: pip

python:
  - 3.3
  - 3.4
  - 3.5
  - 3.6

env:
  matrix:
    - BUILD=py
    - BUILD=flake8
    - BUILD=docs
  global:
    # PACKAGECLOUD_TOKEN
    - secure: U7vOIV6erN8BtStKFB2CDolZTEGaxP3pETDeX9W4uepfnsVf7O3n26ePaUbVXgNNhQiwz2ihtMK0NI1nk8t3RVqFKW9GVCWPdBMRiJG4cPidY7RjapiKXSEcVgyb76E5Yau6Uv18EaRuyn4+vrT3Uk/86BIsVhBs4ronTFCopco=

matrix:
  exclude:
    # Sphinx requires python 3.4 or above
    - python: 3.3
      env: BUILD=docs

addons:
  apt:
    packages:
      - language-pack-de

install:
  - pip install tox

script:
  - tox -e $BUILD

deploy:
  provider: pypi
  user: hobarrera
  password:
    secure: LXSgJZMZICS0Xv5qyR/IRgki1Wy23lurmdepsOsjzBM2fv7rgKPlU/MASVCUCmLi9vYYqZu+7ViHeT6uhJXLdwE0NisVYqTg6L4aD1kqDmbjkWFhLKA7DAz1QTAYxrk6TQYmDb+ZbNFZlF21g29nqvqtLwdC4dFnDjXGnupCoeU=
  on:
    tags: true
  distributions: "sdist bdist_wheel"

after_deploy:
  - gem install package_cloud fpm
  - fpm -s python -t deb setup.py
  - package_cloud push pimutils/todoman/debian/buster *.deb
  - package_cloud push pimutils/todoman/ubuntu/yakkety *.deb
  - package_cloud push pimutils/todoman/ubuntu/xenial *.deb
  - package_cloud push pimutils/todoman/ubuntu/trusty *.deb
  - package_cloud push pimutils/todoman/ubuntu/precise *.deb
  - package_cloud push pimutils/todoman/debian/wheezy *.deb
  - package_cloud push pimutils/todoman/debian/jessie *.deb
  - package_cloud push pimutils/todoman/debian/stretch *.deb
  - package_cloud push pimutils/todoman/debian/buster *.deb
